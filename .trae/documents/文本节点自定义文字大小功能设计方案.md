# 文本节点自定义文字大小功能设计方案

## 一、需求分析

1. **功能需求**：
   - 为文本节点添加自定义文字大小功能
   - 支持通过快捷键（放大/缩小）调整字体大小
   - 采用指数形式缩放（例如：2 → 4 → 8 → 16 → 32）

2. **技术约束**：
   - 当前所有文本节点共享 `Renderer.FONT_SIZE = 32` 常量
   - 渲染时字体大小会乘以相机缩放比例
   - 已有完整的快捷键系统

## 二、方案对比

### 方案1：存储缩放级别（整数）

**设计**：

- 在 `TextNode` 类中添加 `fontScaleLevel` 字段，类型为整数
- 基准值为0，对应默认字体大小（32px）
- 计算公式：`finalFontSize = Renderer.FONT_SIZE * Math.pow(2, fontScaleLevel)`
- 快捷键操作：每次按放大键 `fontScaleLevel++`，按缩小键 `fontScaleLevel--`

**优点**：

- 存储值范围小，占用空间少
- 缩放逻辑清晰，符合用户期望的指数增长
- 便于实现快捷键操作（只需增减整数）
- 支持正负值，可放大可缩小

**缺点**：

- 需要额外计算才能得到实际像素值
- 无法直接表示非2的幂次的字体大小

### 方案2：直接存储像素值

**设计**：

- 在 `TextNode` 类中添加 `fontSize` 字段，类型为数值
- 默认值为 `Renderer.FONT_SIZE`（32px）
- 快捷键操作：根据当前值计算指数缩放后的新值

**优点**：

- 直接存储最终使用的像素值，无需计算
- 支持任意字体大小，灵活性更高
- 直观易懂，便于调试

**缺点**：

- 存储值范围大，占用空间多
- 快捷键操作需要复杂计算（需要记录缩放次数或反向计算当前缩放级别）
- 缩放逻辑不直观，用户难以预测下一次缩放后的大小

## 三、推荐方案

### 推荐方案：存储缩放级别（方案1的改进版）

**设计**：

1. **字段设计**：
   - 在 `TextNode` 类中添加 `fontScale` 字段，类型为数值（支持小数）
   - 默认值为1.0，对应默认字体大小
   - 计算公式：`finalFontSize = Renderer.FONT_SIZE * fontScale`

2. **缩放逻辑**：
   - 快捷键放大：`fontScale *= 2`
   - 快捷键缩小：`fontScale /= 2`
   - 支持直接设置特定缩放比例（如1.5、0.5等）

3. **实现细节**：
   - 添加 `increaseFontSize()` 和 `decreaseFontSize()` 方法
   - 在快捷键注册中添加对应绑定
   - 更新渲染逻辑，使用节点自身的 `fontScale` 计算最终字体大小
   - 确保新字段支持序列化和反序列化

**优势**：

- 结合了方案1和方案2的优点
- 缩放逻辑清晰，符合指数增长预期
- 支持精确调整字体大小
- 存储空间合理
- 便于实现快捷键操作

## 四、实现步骤

1. **修改 `TextNode` 类**：
   - 添加 `@serializable` 装饰的 `fontScale` 字段
   - 添加字体大小调整方法

2. **更新渲染逻辑**：
   - 在 `TextNodeRenderer` 中使用节点的 `fontScale` 计算字体大小
   - 更新 `getMultiLineTextSize` 等相关方法

3. **添加快捷键支持**：
   - 在 `shortcutKeysRegister.tsx` 中注册放大/缩小快捷键
   - 实现快捷键回调函数

4. **数据升级**：
   - 在 `ProjectUpgrader.tsx` 中添加升级逻辑，为旧节点设置默认 `fontScale`

5. **测试验证**：
   - 测试新建节点的默认字体大小
   - 测试快捷键放大缩小功能
   - 测试不同缩放级别的节点渲染效果
   - 测试数据保存和加载功能

## 五、预期效果

- 新创建的文本节点使用默认字体大小（32px）
- 选中文本节点后，按放大键（如 `+`）字体大小翻倍
- 按缩小键（如 `-`）字体大小减半
- 不同节点可以有不同的字体大小
- 保存和加载后字体大小保持不变

## 六、扩展考虑

- 未来可添加字体大小输入框，支持直接输入像素值
- 可添加字体大小范围限制（最小/最大）
- 可支持批量调整多个节点的字体大小

该方案既满足了用户期望的指数缩放效果，又保持了良好的灵活性和可扩展性。
